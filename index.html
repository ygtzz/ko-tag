<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ko tag</title>
    <style>
        .tag-wrap{border:1px solid #ccc;}
        .tag{border-radius: 3px;color: #fff;padding: 2px 0 2px 8px;font-size: 12px;
             display: inline-block;
             margin: 2px 4px 2px 0;
             line-height: 1.4;
        }
        .tag-blue{background: #33C3F0;}
        .tag-input{border:0;outline:0;line-height:1.4;}
        .tag-error{background: #FBD8DB;color: #90111A;width:68px;}        
    </style>
</head>
<body>
    <div style='width:300px;'>
        <div class="tag-wrap">
        <span data-bind="foreach:aTag">
            <span class="tag tag-blue">
                <span data-bind="text:$data"></span>
                <span data-bind="click:$parent.fDelete">×</span>
            </span>
            <span data-bind="text:$parent.sSeparator"></span>
        </span>
        <input data-bind="textInput:sText,event:{keyup:fInputKeyup},css:sTextClass" type="text" class="tag-input"/>
    </div>
    </div>
    
    <script src="knockout-3.4.0.js"></script>
    <script>
        var option = {
            sSeparator : '或'
        };
        ko.applyBindings(new fTagView());
        function fTagView(){
            var self = this;
            self.sSeparator = ko.observable(option['sSeparator'] || '');
            self.bAllowDuplicate = ko.observable(option['bAllowDuplicate'] || false);
            self.bAllowEmpty = ko.observable(option['bAllowEmpty'] || false);           
            self.aTag = ko.observableArray();
            self.fAdd = function(){
                if(self.bTextError()){
                    return;
                }
                self.aTag.push(self.sText());
                self.sText('');
            }
            self.fDelete = function(item){
                self.aTag.remove(item);
            }
            self.fbDuplicate = function(val){
                var aTag = self.aTag();
                for(var i=0;len=aTag.length,i<len;i++){
                    if(aTag[i] === val){
                        return true;
                    }
                }
                return false;
            }
            self.sText = ko.observable();
            self.sTextClass = ko.pureComputed(function(){
                var sText = self.sText();
                if(!option.bAllowDuplicate && self.fbDuplicate(sText)){
                    return 'tag-error';
                }
                if(!option.bAllowEmpty && sText && sText.length < 1){
                    return 'tag-error';
                }
                return '';
            });
            self.bTextError = ko.pureComputed(function(){
                return self.sTextClass().indexOf('tag-error') > -1;
            });
            self.fInputKeyup = function(data,evt){
                switch(evt.keyCode){
                    case 13:
                        self.fAdd();
                        break;
                    default:
                        break;
                }
            }
        }
    </script>
</body>
</html>